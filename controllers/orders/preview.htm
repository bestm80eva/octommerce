<?php Block::put('breadcrumb') ?>
    <ul>
        <li><a href="<?= Backend::url('octommerce/octommerce/orders') ?>">Orders</a></li>
        <li><?= e($this->pageTitle) ?></li>
    </ul>
<?php Block::endPut() ?>

<?php if (!$this->fatalError): ?>

    <div class="scoreboard">
        <div data-control="toolbar" data-disposable="">
            <div class="scoreboard-item title-value">
                <h4>Order #</h4>
                <p><?= $order->order_no ?></p>
                <p class="description"><?= $order->created_at ?></p>
            </div>
            <div class="scoreboard-item title-value">
                <h4>User</h4>
                <p class="oc-icon-user"><?= $order->name ?></p>
                <p class="description"><a href="mailto: <?= $order->email ?>"><?= $order->email ?></a> | <?= $order->phone ?></p>
            </div>
            <div class="scoreboard-item title-value">
                <h4>Total</h4>
                <p><small>IDR</small> <?= number_format($order->total) ?></p>
                <?php if($order->discount > 0): ?>
                <p class="description">Disc: <?= number_format($order->discount) ?></p>
                <?php endif ?>
            </div>
            <div class="scoreboard-item title-value">
                <h4>Status</h4>
                <?php
                switch($order->status) {
                    case 'quote':
                        $status_icon = 'oc-icon-question';
                        break;
                    case 'pending':
                        $status_icon = 'oc-icon-clock-o';
                        break;
                    case 'half-paid':
                    case 'paid':
                        $status_icon = 'oc-icon-check';
                        break;
                    case 'cancelled':
                    case 'failed':
                    case 'expired':
                        $status_icon = 'oc-icon-times';
                        break;
                }
                ?>
                <p><?= $order->status ? $order->status->name : '' ?></p>
                <p class="description"><?= $order->status_updated_at ?></p>
            </div>
        </div>
    </div>

	<div class="form-buttons buttons-offset">
        <div class="loading-indicator-container">
            <a
                href="<?= Backend::url('octommerce/octommerce/orders/update/'.$formModel->id) ?>"
                class="btn btn-primary">
                Edit details
            </a>
            <a
                href="javascript:;"
                data-control="popup"
                data-handler="onLoadChangeStatusForm"
                class="btn btn-default">
                Update status
            </a>
            <a
                href="javascript:;"
                onclick="$('#<?= $this->getId('invoiceIframe') ?>').trigger('print.invoice')"
                class="btn btn-default">
                Print invoice
            </a>
            <a
                href="#"
                data-request="onSendEmailToCustomer"
                data-load-indicator="Sending email to <?= $order->email ?>..."
                data-request-confirm="Send email to <?= $order->email ?>?"
                class="btn btn-default">
                Email to Customer
            </a>
            <a
                href="javascript:;"
                data-request="onDelete"
                data-load-indicator="Deleting Order..."
                data-request-confirm="Delete this order?"
                class="btn btn-danger">
                Delete
            </a>
        </div>
    </div>

    <div class="form-preview">
        <?= $this->formRenderPreview() ?>
    </div>

<?php else: ?>

    <p class="flash-message static error"><?= e($this->fatalError) ?></p>
    <p><a href="<?= Backend::url('octommerce/octommerce/orders') ?>" class="btn btn-default">Return to orders list</a></p>

<?php endif ?>